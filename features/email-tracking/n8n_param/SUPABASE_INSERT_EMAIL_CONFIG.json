{
  "nodes": [
    {
      "parameters": {
        "tableId": "agent_emails",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "deployment_id",
              "fieldValue": "={{ $('Get Deployment').item.json.id }}"
            },
            {
              "fieldId": "email_address",
              "fieldValue": "={{ $('Send Email').params.to }}"
            },
            {
              "fieldId": "first_name",
              "fieldValue": "={{ $json.first_name || null }}"
            },
            {
              "fieldId": "last_name",
              "fieldValue": "={{ $json.last_name || null }}"
            },
            {
              "fieldId": "email_subject",
              "fieldValue": "={{ $('Send Email').params.subject }}"
            },
            {
              "fieldId": "email_body_html",
              "fieldValue": "={{ $('Send Email').params.html_message || null }}"
            },
            {
              "fieldId": "email_body_text",
              "fieldValue": "={{ $('Send Email').params.message }}"
            },
            {
              "fieldId": "has_attachments",
              "fieldValue": "={{ $('Send Email').params.attachments ? true : false }}"
            },
            {
              "fieldId": "attachment_names",
              "fieldValue": "={{ $('Send Email').params.attachments ? $('Send Email').params.attachments.map(a => a.name) : null }}"
            },
            {
              "fieldId": "email_type",
              "fieldValue": "follow_up"
            },
            {
              "fieldId": "provider",
              "fieldValue": "gmail"
            },
            {
              "fieldId": "workflow_message_id",
              "fieldValue": "={{ $('Send Email').item.json.id }}"
            },
            {
              "fieldId": "gmail_thread_id",
              "fieldValue": "={{ $('Send Email').item.json.threadId }}"
            },
            {
              "fieldId": "status",
              "fieldValue": "sent"
            },
            {
              "fieldId": "sent_at",
              "fieldValue": "={{ new Date().toISOString() }}"
            },
            {
              "fieldId": "provider_cost",
              "fieldValue": "0"
            },
            {
              "fieldId": "billed_cost",
              "fieldValue": "={{ $('Get Deployment').item.json.cost_per_email || 0 }}"
            },
            {
              "fieldId": "currency",
              "fieldValue": "EUR"
            },
            {
              "fieldId": "workflow_id",
              "fieldValue": "={{ $workflow.id }}"
            },
            {
              "fieldId": "workflow_execution_id",
              "fieldValue": "={{ $execution.id }}"
            },
            {
              "fieldId": "metadata",
              "fieldValue": "={{ { workspaceId: $json.workspaceId, agentId: $json.agentId, companyId: $json.companyId } }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [1400, 300],
      "id": "supabase-insert-email",
      "name": "Supabase Insert Email",
      "credentials": {
        "supabaseApi": {
          "id": "XsVol30xDDqWJuLk",
          "name": "Voipia - Supabase"
        }
      }
    }
  ],
  "connections": {},
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true
  }
}
